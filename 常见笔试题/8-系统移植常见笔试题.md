# 系统移植常见笔试题

1. 什么叫做交叉编译？

   ```
   交叉编译就是在一台主机上编辑和编译程序，而把编译好的程序放到另外一台机器上执行。比如嵌入式开发中我们在电脑上编辑和编译程序，而编译好的程序被下载到开发板执行。
   ```

2. 简述一个装有linux内核的开发板的启动过程？

   ```
   一个装有linux内核的开发板上电后的第一个程序一般是uboot，uboot首先对软硬件资源进行初始化，然后将固化在存储器中的内核以及相关文件引导加载到内存中，然后内核开始运行，内核首先对软硬件资源进行初始化，内核初始化完成后内核从指定位置去挂载根文件系统，根文件系统挂载完成后就可以运行上层的应用程序即完成了系统的启动。
   ```

3. 什么是bootloader？在嵌入式系统当中bootloader的作用是什么？

   ```
   Bootloader是引导加载程序的统称，是嵌入式系统上电后的第一段代码，其主要作用是将硬件初始化到一个合适的状态并将嵌入式操作系统加载到内存中执行。
   ```

4. 简述uboot的主要功能有哪些？

   ```
   uboot最主要的功能有以下几点
   1）初始化一些硬件为后续做准备  
   2）引导和加载内核
   3）给内核传参
   4）执行用户命令
   ```

5. 简述uboot的启动过程？

   ```
   uboot的启动过程可以分两个阶段，第一个阶段主要由汇编语言来实现，第二个阶段主要由C语言来实现。
   第一阶段中uboot主要对基本的硬件（比如处理器状态、时钟、内存等）进行了初始化，然后对自身进行自搬移，即将uboot自身从固化的存储器中搬移到内存中以便后续执行，最后初始化了C语言的运行环境（比如初始化栈、BSS段等）为后续的C语言代码的运行做准备。
   第二阶段中uboot将大部分硬件进行了初始化，然后从存储器中读取环境变量，将linux内核相关文件加载到内存并运行，或者按照用户命令执行对应的操作。
   ```

6. 操作系统的作用有哪些？

   ```
   进程管理、内存管理、文件系统、网络协议、设备管理
   ```

7. Linux内核启动流程

   ```
   1. Linux内核自解压过程
   uboot完成系统引导以后，执行环境变量bootm中的命令；即，将Linux内核调入内存中并调用do_bootm函数启动内核，跳转至kernel的起始位置。如果内核没有被压缩，则直接启动；如果内核被压缩过，则需要进行解压，被压缩过的kernel头部有解压程序。
   2. Linux内核启动准备阶段
   （1）关闭IRQ、FIQ中断，进入SVC模式
   （2）校验处理器ID，检验内核是否支持该处理器；若不支持，则停止启动内核。
   （3）校验机器码，检验内核是否支持该机器；若不支持，则停止启动内核。
   （4）检查uboot向内核传参ATAGS格式是否正确
   （5）建立虚拟地址映射页表。
   （6）跳转执行__switch_data函数，其中调用__mmap_switched完成最后的准备工作。
           1）复制数据段、清除bss段，目的是构建C语言运行环境；
           2）保存处理器ID号、机器码、uboot向内核传参地址；
           3）b   start_kernel跳转至内核初始化阶段。
   3. Linux内核初始化阶段
   此阶段从start_kernel函数开始。start_kernel函数是所有Linux平台进入系统内核初始化的入口函数。它的主要工作是完成剩余与硬件平台相关的初始化工作，在进行一系列与内核相关的初始化之后，调用第一个用户进程init并等待其执行。至此，整个内核启动完成。
   
   start_kernel函数主要完成内核相关的初始化工作。具体包括以下部分：
   （1）内核架构 、通用配置相关初始化 
   （2） 内存管理相关初始化
   （3）进程管理相关初始化 
   （4）进程调度相关初始化
   （5）网络子系统管理
   （6）虚拟文件系统
   （7）文件系统 
   ```

8.  zImage和uImage的区别

   ```
   vmlinux是内核文件
   zImage是一般情况下默认的压缩内核映像文件，压缩vmlinux，加上一段解压启动代码得到。
   而uImage则是使用工具mkimage对普通的压缩内核映像文件（zImage）加工而得。它是uboot专用的映像文件，它是在zImage之前加上一个长度为64字节的“头”，说明这个内核的版本、加载位置、生成时间、大小等信息；其0x40之后与zImage没区别。其实就是一个自动跟手动的区别,有了uImage头部的描述,u-boot就知道对应Image的信息,如果没有头部则需要自己手动去搞那些参数。
   如何生成uImage文件？
   首先在uboot的/tools目录下寻找mkimage文件，把其copy到系统/usr/local/bin目录下，这样就完成制作工具。然后在内核目录下运行make uImage，如果成功，便可以在arch/arm/boot/目录下发现uImage文件，其大小比 zImage多64个字节。此外，平时调试用uImage，不用去管调整了哪些东西；zImage则是一切OK后直接烧0X0。开机就运行。
   ```

9. linux内核在启动过程中遇到什么情况会打印系统崩溃报告Oops？

   ```
   当linux内核在启动过程中出现以下几种问题的时候会打印系统崩溃报告
   1）内存访问越界  2）使用非法指针  3）使用了NULL指针  4）使用了不正确的指针
   ```

10. 系统移植中的kernel panic产生原因，及解决方法

    ```
    setenv bootargs root=/dev/nfs nfsroot=192.168.1.100:/home/linux/storage/rootfs rw console=ttySAC2,115200   init=/linuxrc ip=192.168.1.200
    挂在不上根文件系统会在内核启动的过程中报kernel panic的错误，主要有三大产生的原因
    1. 没有在正确的位置烧写正确格式的文件系统映象
    	主要是bootarg这个环境变量设置的内容、ubuntu下根文件系统的绝对路径、nfs服务器配置文件中默认访问路径，三个路径保持一致
    2. 内核不支持这种文件系统格式
    	配置内核时选上支持的文件系统格式
    3. 文件系统的内容不完整
    	init=/linuxrc 的作用是，挂接文件系统后，内核就会读取、执行文件系统中的/linuxrc文件，通过它来启动应用程序。如果这个目录中的东西不对、不全，即使制作出了文件系统映象，也只是能识别出来，挂接上去，但是启动不了。
    ```

11. 开发板中为什么一般不需要安装静态库？

    ```
    库可以分为静态库和动态库，静态库一般是编译程序的时候使用而动态库一般是程序运行的时候用，在嵌入式开发中一般我们使用交叉编译的方式，即我们编辑和编译程序是在电脑下而程序编译完成后下载到开发板执行，所以一般不会在开发板编译程序，所以开发板一般不需要安装静态库。
    ```

    

