# 第八章 控制语句之循环

程序中经常需要在同一处重复做一些相同动作，这需要编程语言提供循环语句来支持，
C语言中提供了三种循环语句供程序员根据自己的喜好、或方便、简洁程度来选择使用。

# 第一节 while循环

while循环被称为入口条件式循环，其语法形式如下：

```c
while(条件表达式)
{//循环体
    //需要被重复的语句们
}
```


//后续语句
执行方式如下：

1. 计算条件表达式的值
2. 如果其值为真就执行循环体，为假则整个while语句结束运行，继续执行后续语句 （循环体被执行一次又被称为迭代一次）
3. 执行完循环体，再次计算条件表达式的值，重复做第2步，直到某次为假结束运行整个while语句，继续执行后续语句

显然：
1. 第一次计算条件表达式的值如果为假，则循环体可能一次没有被执行（先判断后执行）
2. 条件表达式每次循环都被重新计算
3. 条件表达式为假或为0之前，重复执行循环体里的语句
4. 如果条件表达式的值一直是真或非0，那么我们程序也会一直执行循环体而没机会执行后续语句，这样的循环我们称为死循环

怎么避免死循环呢？后面为了讲解方便，先说两个术语：
1. 循环条件：就是指while后面括号里的条件表达式
2. 循环变量：条件表达式中用到的一些变量，这些变量的值在循环语句执行时会影响条件表达式的运算结果，
                     简单的循环这样的变量往往只有一个，复杂的可能会有多个哟！


编写循环语句时，大家可以参照如下思维步骤（同样适用于for循环和do-while循环）：
1. 设立循环条件，想好满足什么条件才重复做某些动作是最关键的一步
2. 从循环条件中分析出循环变量
3. 第一次计算循环条件之前，对每个循环变量设立合理初值（每次进循环之前）
4. 下一次计算循环条件之前，循环体某处合理更新改变循环变量的值



课堂练习1：求1、2、3。。。。100的和  （可以不写多函数形式）

课堂练习2：判断输入的10进制数是否各个位均不包含3



# 第二节 for循环

for循环被称为计数循环，其语法形式如下：

```c
for(表达式1;循环条件表达式2;表达式3)
{//循环体
    //需要被重复的语句们
}
```

这种语句完全等价于如下while循环的写法：

```c
表达式1;
while(循环条件表达式2)
{//循环体
    //需要被重复的语句们
    表达式3;
}
```

执行方式非常显然，不必重复，几点说明：
1. 表达式1用来对循环变量置初值，其只是在第一次循环判断前被执行一次
2. 表达式3用来更新改变循环变量的值

那么C语言为何在while之外还要提供for循环呢？因为：
1. 容易避免新手常犯的一些错误，新手经常忘记对循环变量置初值或更新循环变量的值，for循环在语法上起到提醒作用
2. 与while循环相比在continue语句后的处理不一样，见本章4.1节
3. for更加灵活，你可以让一个或多个甚至所有表达式为空（但两个分号;不可遗漏），
    循环条件表达式2为空时条件认为为真。新手不鼓励省略这些表达式不写！
4. for循环让那些循环次数可数的循环更加清晰简洁。



课堂练习1：打印1-200之间的所有的偶数，每行最多显示10个数 （可以不写成多函数形式）

课堂练习2：从键盘输入一个正整数，判断是否是完数
   一个数如果恰好等于它的因子之和,这个数就 称为"完数"。
   例如，6的因子为1、2、3，而6=1+2+3，因此6是"完数"



# 第三节 do-while循环

do-while循环被称为退出条件循环，其语法形式如下：

```c
do
{//循环体
    //需要被重复的语句们
}while(条件表达式);
```

与for和while不一样，do-while循环的执行方式如下：
1. 执行循环体
2. 计算条件表达式的值，如果为真重做第1步，为假则结束整个do-while循环

显然：
1. 循环体至少被执行一次（先执行后判断）
2. 条件表达式每次执行完循环体都被重新计算
3. 条件表达式为假或为0之前，重复执行循环体里的语句

其实，do-while循环可以等价地写成如下形式：
//需要被重复的语句们
while(条件表达式)
{
    //需要被重复的语句们
}

这种写法有一次重复而已，但是这次重复往往很容易头疼，尤其在被重复的语句们需要被修改时。

注意，与之前的复合语句不同，整个do-while循环的最后必须有分号结尾，因为它不以}结尾，
说到这儿顺便提及一下C语言中分号的使用，尤其新手常犯的毛病就是多个分号或少个分号



课堂练习1：石头剪刀布，要求询问是否继续？ 

课堂练习2：猜数游戏

# 第四节 循环辅助手段

## 4.1 continue语句：continue;

continue单词含义是继续，对于循环而言，就是让continue隶属的循环语句继续下一次循环，
意味着循环体内continue后续的语句本次循环将不被执行，具体的：

1. while、do-while而言，循环体内一旦执行continue语句，立即重新计算判断循环条件，依据结果决定是继续下一次循环还是结束整个循环
2. for而言，循环体内一旦执行continue语句，立即执行表达式3，然后重新计算判断循环条件，依据结果决定是继续下一次循环还是结束整个循环

注意：continue语句只能用在循环体里

课堂练习：打印1到20，但跳过3的倍数

```c
#include <stdio.h>

int main()
{
    int i = 0;
    
    for(i = 1;i <= 20;i++)
    {
        if(i % 3 != 0)
        {
        	printf("%-3d",i);
        }
        else
        {
            continue;
        }
    }
    printf("\n");
    
    retrun 0;
}
```



## 4.2 break语句：break;

break单词含义为打断、中止，对循环而言，就是让break隶属的循环语句不要继续执行，立即中止执行后续语句，
意味着循环体内一旦执行break语句，循环应立即停止执行，程序则直接跳转到整个循环语句后的下一条语句。
三种循环都是一样的反应。具体应注意：

1. for循环中break与continue不一样，break一旦被执行，下一条语句不是第三个表达式，
    而是和while、do-while循环一样中止循环，转而执行整个循环语句的下一条语句。
2. break语句与continue第二个不一样，它可以被用在switch语句中，作用是中止整个switch语句，
   转而执行整个switch语句的下一条语句 

注意：break语句只能用在switch和循环中，其它复合语句中不可以使用break语句。



课堂练习：判断一个数是不是素数

# 第五节 嵌套循环

所谓嵌套循环就是一个循环语句是另一循环体中的一条语句。其实不仅循环嵌套循环，各复合语句间均可以相互嵌套，而且嵌套层次理论是没有限制的。

以两层的嵌套循环为例，如两层嵌套循环语法形式如下：

```c
while(条件表达式1)   //外层循环
{
    //...内层循环前的语句
    while(条件表达式2) //内层循环
    {
        //...内层循环体中的语句
    }
    //...内层循环后的语句
}
//...后续语句
```


很显然：

1. 内层循环语句只是外层循环体中的一条语句而已，因此只有内层循环语句执行完毕，外层循环才有可能进行下一次循环
2. 这样的两层循环相比一层循环其复杂性表现在内层循环的循环条件往往与外层循环的循环变量有着至关重要的联系，找到这种联系是写内层循环的关键，当然也可能没有联系，那样的整体逻辑往往应该是比较简单的。
3. 当嵌套层次进一步加深时，整个逻辑复杂度相应地加深，一般在项目开发中遵循“事不过三”的原则，即尽量不要超过三层嵌套，程序逻辑上如果必须要很多层的嵌套，则可以将内层循环的功能设计一个函数，变循环语句为函数调用语句。

例如两层嵌套循环可以这样去完成：

```c
Type func(....)
{
    //...原内层循环
}

while(条件表达式1)   //外层循环
{
    //...内层循环前的语句
    func();
    //...内层循环后的语句
}
//...后续语句
```

总结：函数除实现某些功能的作用外，它不但可以减轻重复劳动，还可以帮我们简化逻辑，
如果将一个程序的所有核心步骤都做成函数,像main函数这样的函数只能起到拼装的作用，
其它函数则成了被拼装的形状各异的小积木模块，
因此总结一下，项目中在如下情况下需要将一些功能设计成函数：

1. 单一功能型函数：这样的函数作用就是为了实现一个单一的、逻辑较为复杂的功能
2. 简化逻辑型函数：这样的函数设计初衷是为了简化多层嵌套的代码逻辑
3. 拼装功能型函数：这样的函数功能实现主要通过调用其它函数完成，其自身逻辑反而并不复杂，最典型的就是任何项目中的main函数



课堂练习1：

```
打印直角三角形
*
**
***
****
*****
******
```



课堂练习2：打印99乘法表



课堂练习3：

```
打印菱形
   *
  ***
 *****
*******
 *****
  ***
   *
```





课堂练习4：打印2~200间的所有素数



课堂练习5：

```
打印等腰三角形
     A
    BBB
   CCCCC
  。。。。
Z..............Z
共计26行
```



课堂练习6：输出用 50元、20元 和 10元换算 100元的所有方式？

# 第六节 常用循环技巧

## 6.1 共同遵循的规则

书写任何循环逻辑的代码，都应遵循如下思维步骤：

1. 设立合理的循环条件，分析出循环变量
2. 循环每次执行前，设置循环变量的初值
3. 编写循环体
4. 下一次循环前合理更新改变循环变量的值

## 6.2 三种循环的选择

项目中三种循环的选择原则：

1. 循环体可以一次不被执行选用while或for循环，必须被执行一次的选择do-while循环
2. 循环次数可数的选用for循环，次数不可数的选择while循环

## 6.3 哪种写法效率更高

比较一下这两种写法的效率：
第一种：

```c
while(循环条件表达式)
{
    if(选择条件表达式)//此条件与循环变量无任何关联
    {
        //do somthing
    }
    else
    {
        //do other something
    }
}
```

第二种：

```c
if(选择条件表达式) //此条件与循环变量无任何关联
{
    while(循环条件表达式)
    {
        // do something
    }
}
else
{
    while(循环条件表达式)
    {
        // do other something
    }
}
```

很明显，第一种的选择条件表达式被重复计算、判断，而这种重复与我们想要逻辑是没有关系的，
是无用重复，是额外多出的动作，因此效率明显低于第二种。

## 6.4 注意边界的处理和运用

循环的边界其实就是第一次循环和最后一次循环，注意边界就是让你特别留意第一次循环前循环变量的值，和最后一次循环后循环变量的值，
前者一旦出错影响整个循环逻辑，后者的值往往可以在整个循环的后续语句中被继续运用。

## 6.5 特殊形式的循环

一、不想退出的死循环
在项目中很多程序运行起来后是不再退出的，
除非出现了某种无法让程序继续执行的错误或者用户决定退出或者通过其它手段强制终止程序的执行。
最典型的如：服务器程序或图形界面程序。
这些程序往往被一个刻意的死循环维持着，这样的死循环一般都写成如下形式：
while(1)
{
    //....break;
}

有些项目也可能写成如下形式：
for(;;)
{
    //...
}

个人建议第一种形式直接明了，第二种个人看上去就是有点说不出的别扭^_^ !



二、只想执行一次的循环
在老东家做开发时，有一个项目的客户是美国高通，老外要求项目中的所有函数：

1. 只能有一个出口
2. 不能使用goto语句

我们当初使用的方式比较古怪：
Type func(...)
{
    do
    {
        //函数体语句
    }while(0);
    return Type类型的表达式;
}

这样的形式就是为了运用break语句，这样可以在只会被执行一次的循环体的中间根据情况中途中止循环。

个人对老外的这一要求倒不是特别感冒，但是也应适当掌握好一个度，函数体中的return语句也不能到处乱飞，
核心逻辑前的检查可以直接return一些错误情况，核心逻辑执行过程中尽量不要使用return语句，
return语句应统一放置在核心逻辑之后。模板如下：

```c
Type func(...)
{
    if(非核心逻辑的条件1)
    {
        return 异常值1;
    }
    if(非核心逻辑的条件2)
    {
        return 异常值2;
    }
    //.....
    //核心逻辑代码
    return 正常值;
}
```



# 第七节 C库函数之rand、srand、time

rand函数

```c
int rand()
/*
	函数功能：产生一个随机数，并更新系统为每个程序指定的随机种子数
	返回值：新产生的随机数
	
	备注：
	1. 系统为每个程序指定了一个相同的初始随机种子数
	2. 产生随机数的过程：将种子数代入一个固定公式求得，每次求完用新随机数去更新种子数
*/
  
```

srand函数

```c
unsigned int srand(unsigned int seed)
/*
函数功能：修改随机种子数
参数：
	seed：将随机种子数修改为seed值
返回值：新的随机种子数
备注：
   1. 本函数只是修改随机种子数，不产生新的随机数
   2. 本函数一般忽略返回值调用
   3. 本函数一般仅在程序开始时调用一次(如果程序中用到随机数)
   4. 本函数一般都结合time函数一起调用  srand(time(NULL));
*/
```

time函数

```c
time_t time(time_t *tloc)
/*
函数功能：返回1970-1-1 0：0:0到本函数被调用这个时刻间的秒数
参数：
	tloc：现在只需填为NULL
备注：time_t可以看作int类型
*/
```

