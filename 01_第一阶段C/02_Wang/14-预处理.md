# 第一节 编译全过程

?              预处理    编译     汇编                    链接

  f1.c         f1.i       f1.S     f1.o
  f2.c         f2.i       f2.S     f2.o
  ...                                                        可执行文件名
  fn.c         fn.i       fn.S     fn.o
                                       库文件  



# 第二节 预处理

1. 傻替换
2. 条件编译：根据指定的条件决定哪些代码参与编译，哪些代码不参与编译（不参与编译的代码等同于被注释）
3. 给下一步编译指定一些参数

#开头的命令 ---- 预处理命令

# 第三节 宏定义之无参宏定义

宏 ----- 替换规则的统称

C语言中的宏------傻替换----原封不动地替换

#define 宏名  宏体

宏名：满足标识符命名规则，项目中建议字母全大写

宏体：内容无限制，但要确保替换后语法的正确性
      宏体可以为空 ------ 开关宏 / 宏开关
      不以分号，结尾如果有分号，分号则隶属于宏体内容

替换规则：傻替换

当宏体为表达式，建议将整个宏体用()括起来

当宏体为表达式多条语句时，建议将整个宏体用{}括起来

宏名作用域
    默认作用域：宏定义所在行开始 ------  到所隶属的.c文件结尾
    #undef  宏名
    宏定义所在行开始 ------ 到对应#undef语句

无链接性



宏定义语句要确保在同一行上，不可以直接跨行书写，
                 但可以用续行符\配合后跨行书写
                 \要保证是一行的最后一个字符，
                 实际是告诉gcc下一行与\所在行是同一行内容
                 

#define M asdjfjasdgfj \
          amshdgfhjasg  \
          adghjasg

```
#define M  {x = 2;y=3;}

if(z > 0)
	M;
```

# 第四节 宏定义之带参宏定义

#define 宏名(宏参列表)  宏体
#define 宏名(参数名1,参数名2,...,参数名n)  宏体

宏体：没有任何限制，但要确保替换后符合语法
不做类型检查
替换步骤：
   1)宏名(实际宏参1,实际宏参2,...实际宏参n) ---->替换为宏体   傻替换
   2)宏体中所有参数名再被替换为对应实际宏参                     傻替换

当宏体是表达式时，整个宏体建议用()括起来
当宏体是表达式时，宏体中所有参数名建议用()括起来

当宏体是多条语句时，整个宏体建议用{}括起来

宏定义语句要确保在同一行上，不可以直接跨行书写，
                 但可以用续行符\配合后跨行书写
                 \要保证是一行的最后一个字符，
                 实际是告诉gcc下一行与\所在行是同一行内容

#define M(a,b)  a+b

x = M(3,4) * 2; ---> x = a+b * 2; ---> x = 3+4 * 2
x = ? 11 而不是14

#define M(a,b)  (a+b)
x = M(3,4) * 2; ---> x = (a+b) * 2; ---> x = (3+4) * 2
x = ? 14

#define M(a,b) a * b

x = M(1+2,3+4);---->x = a * b----> x = 1+2 * 3+4
x = ? 11 而不是 21

#define M(a,b) (a) * (b)

x = M(1+2,3+4);---->x = (a) * (b)----> x = (1+2) * (3+4)
x = ? 21

特殊运算符：运用在宏体中
1. ---- 字符串化    #

2. ---- 名称连接    ##



# 第五节 预定义宏

`__FILE__`:被所隶属的.c文件名替换
`__LINE__`:被所隶属.c文件的对应行的行号



# 第六节 条件编译

决定哪些代码参与下一步编译，哪些代码不参与下一步编译
所有不参与编译的代码等同于被注释掉了

```
#if 常量表达式  
... //常量表达式为真时被编译，为假时被注释
#else
... //常量表达式为真时被注释，为假时被编译
#endif

#if 常量表达式
....//常量表达式结果为真（非0）时，参与编译，否则则被注释
#endif


//...
/*
....
*/

#if 0
....//被注释
#endif
```



```
#define 宏名 

#ifdef 宏名    ----> #if defined 宏名
...//宏名如果被定义了参与编译，否则被注释
#else
...//宏名如果被定义了则被注释，否则参与编译
#endif
```

```
//#define 宏名 

#ifdef 宏名
...//被注释
#else
...//参与编译
#endif
```

```
#define 宏名
#ifdef 宏名
...//参与编译
#endif
```

```
//#define 宏名
#ifdef 宏名
...//被注释
#endif
```

```
#define 宏名
#ifndef 宏名  ---->#if !defined 宏名
...//被注释
#else
...//参与编译
#endif
```

```
//#define 宏名
#ifndef 宏名
...//参与编译
#else
...//被注释
#endif
```

```
#define 宏名
#ifndef 宏名
....//被注释
#endif
```

```
//#define 宏名
#ifndef 宏名
....//参与编译
#endif
```



# 第七节 头文件的作用和编写

头文件不是C语言编程必须的
如果有头文件，会给我们带来很大的便利 
              --- 解决重复修改
              ---达到一处改动多处生效
由于这些文件都是在.c文件的开头部分被#include语句引进到.c文件中
因此称为头文件，并且以.h作为文件扩展名 （head）

头文件的作用：给多个.c文件提供一些共同信息，比如：结构体构造语句、函数声明、宏定义等等

头文件的内容：非执行语句（static全局变量声明除外）

函数定义--- 执行
函数声明 --- 非执行
函数调用  --- 执行
表达式语句 --- 执行
复合语句： --- 执行
			无头无尾的普通复合语句  
           有头无尾的复合语句
           有头有尾的复合语句
空语句 --- --- 执行 
          ;  {}  
变量定义：--- 执行
          局部变量
          函数形参
          static全局变量：不实用
          非static全局变量：不能重名
非static全局变量声明语句 --- 非执行
static全局变量声明语句 --- 非执行  ---- 不实用（多个.c间）
宏定义   --- 非执行
类型设计语句： --- 非执行
        结构体 共用体 枚举
#include语句 --- 非执行

头文件的内容：
1. 非执行语句
2. 允许多个.c使用同一个名字的情况

头文件的模板：

```c
//开头的宏名要求在同一个项目不能出现重名，一种避免重名的办法是宏名根据头文件的名称来取名
#ifndef  宏名
#define  宏名

其它头文件包含

宏定义

类型设计语句

函数声明

非static全局变量声明

#endif
```

第一行的宏名与第二行的宏名必须一致
第一行、第二行、最后一行的作用是为了防止头文件内容被重复包含

.c文件内容的模板：

```c
头文件包含
    操作系统的头文件
    C库头文件
    第三方头文件
    其它模块提供的头文件
    本模块私有头文件
    
宏定义：只有本.c用的宏定义

类型设计：只有本.c用的类型
    
非static全局变量定义

static全局变量定义

非static全局变量声明：其它.c中定义的全局变量

函数声明

函数定义
```

# 第八节 头文件包含

傻替换：用整个头文件的内容替换本条#include语句

#include <头文件名>
#include "头文件名"

1. 头文件名可以带路径 ---- 相对路径
   不使用绝对路径 --- 头文件位置改变后需要修改绝对路径 
   
2. 包含操作系统、C库、第三方库用<>
   包含自己写的、同一个项目内的用""
   
3. 

   ?		"":

   1. 先找当前目录（包含头文件的.c文件所在的目录）

    2. 编译选项 `-I`指定的目录下找

    3. 系统指定目录下找

     <>:

     1. 编译选项 `-I`指定的目录下找

     2. 系统指定目录下找

gcc的`-I` 选项用法：
1. `-I路径`  ---- 正确
   `-I 路径` ---- 错误写法
2. 一个`-I`只能跟一个路径
3. 可以写多个`-I`


项目中常用的头文件内容：

打印信息
错误
警告
调试信息

```c
//#define XXX_ERROR
#ifdef XXX_ERROR   
#define PrintError   printf("Error:in %s at %d-",__FILE__,__LINE__);\
                     printf
#else
#define PrintError(...)  
#endif

#define XXX_WARN
#ifdef XXX_WARN
#define PrintWarning   printf("Warning:in %s at %d-",__FILE__,__LINE__);\
                     printf
#else
#define PrintWarning(...)  
#endif

#define XXX_INFO
#ifdef XXX_INFO
#define PrintInfo   printf("Info:in %s at %d-",__FILE__,__LINE__);\
                     printf
#else
#define PrintInfo(...)  
#endif

#define MIN(a,b)  ((a) < (b) ? (a) : (b))
#define MAX(a,b)  ((a) > (b) ? (a) : (b))
```











